# 自定义请求库

bilibili_api 作为一个爬虫库，自然依靠底层的网络请求库得以实现。具体地，bilibili_api 会在每次运行中使用可持久化的会话对象（`session`），但具体到每一个函数上，它们不会直接调用底层的网络请求库。每一个函数会在请求时调用 `Api` 类，因为请求字段中可能有固定的比较繁琐的加密方式（如 json_body）或反爬虫逻辑（如 wbi），然后 `Api` 类负责具体调用第三方请求库。

bilibili_api 默认使用 `curl_cffi` 作为底层的第三方请求库，但是第三方请求库可能面临着在具体项目中被更换/替代的需求，因此模块也同时兼容其他的第三方请求库作为底层（具体如何支持见下文）。但是每个网络请求模块实现的逻辑可能不同，api 也可能不同，导致 `Api` 在调用时针对不同的请求库需要使用不同的传参方式和不同的回调方式，乃至是不同的函数和不同的流程。

为了更好地、尽量多的兼容其他请求库，同时保证代码简洁，`Api` 类到底层请求库的 `session` 中间会再次添加另一个中间层，`client`。`client` 需要用户自己编写，其需要满足对第三方请求库的 `session` 的封装，对外暴露模块规定的 api，`Api` 类请求的时候直接实例化 `client`，同时采用统一规定的 api 进行请求，这样子只需要用户在外部重写 `client` 而非重写模块的代码即可实现对请求库的替代。
